@model OxPollen.ViewModels.Taxon.TaxonDetailViewModel

@{
    ViewBag.Title = Model.LatinName + " (" + Model.Rank + ") - Reference Collection";
    ViewData["Description"] = "View reference images for " + Model.LatinName + " pollen, alongside botanical description and geographic range. Use our collections for your pollen identification today.";
}

<link rel="stylesheet" href="~/lib/nouislider/distribute/nouislider.min.css"> @* TODO Move this *@
<link rel="stylesheet" href="~/lib/leaflet/dist/leaflet.css"> @* TODO Move this *@

@* Header *@
@section homepageHeader {
    <div class="addgrain-section headsection">
        <div class="container">
            <h2>@Model.LatinName</h2>
            <p><strong>@Model.Rank</strong> in the Global Pollen Project Reference Collection</p>
        </div>
    </div>
    <br />
}

@* Breadcrumb *@
<div class="row">
    <div class="col-md-12">
        <ol class="breadcrumb">
            <li><a asp-action="Index" asp-controller="Home">Home</a></li>
            <li><a asp-action="Index">Pollen Reference Collection</a></li>
            <li class="active">@Model.Id: @Model.LatinName</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading"><span class="glyphicon glyphicon-film"></span> Grains</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12">
                        <label>Digitised Reference Slides</label>
                        <ul class="grain-grid columns-8">
                            @foreach (var grain in Model.ReferenceGrains)
                            {
                                <li>
                                    <a href="/Reference/Grain/@grain.ReferenceGrainId">
                                        <div class="img-container">
                                            <img src="@grain.Images.First().FileNameThumbnail" />
                                        </div>
                                    </a>
                                </li>
                            }
                        </ul>
                        <hr />
                        <label>User Submissions</label>
                        <ul class="grain-grid columns-8">
                            @foreach (var grain in Model.SubmittedGrains)
                            {
                                <li>
                                    <a href="/Grain/Identify/@grain.Id">
                                        <div class="img-container">
                                            <img src="@grain.Images.First().FileNameThumbnail" />
                                        </div>
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading"><span class="glyphicon glyphicon-book"></span> Definition</div>
            <div class="panel-body">
                <div class="row" id="warnings-container" style="display:none">
                    <div class="col-md-12">
                        <div class="alert alert-warning" role="alert">
                            <p style="display:none" id="neotoma-warning"><span class="glyphicon glyphicon-warning-sign"></span> Neotoma Link: Past distribution currently unavailable for this taxon.</p>
                            <p style="display:none" id="gbif-warning"><span class="glyphicon glyphicon-warning-sign"></span> GBIF Link: Present distribution currently unavailable for this taxon.</p>
                            <p style="display:none" id="gbif-warning-desc"><span class="glyphicon glyphicon-warning-sign"></span> GBIF Link: No English descriptions can be retrieved for this taxon.</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label>Distribution</label>
                        <input hidden="hidden" id="NeotomaId" value="@Model.NeotomaId" />
                        <input hidden="hidden" id="GbifId" value="@Model.GbifId" />
                        <div>
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#modern" aria-controls="modern" role="tab" data-toggle="tab">Present</a></li>
                                <li role="presentation"><a href="#paleo" aria-controls="paleo" role="tab" data-toggle="tab">Past</a></li>
                            </ul>
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="modern">
                                    <div id="map" style="height:300px"></div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="paleo">
                                    <div id="neotoma-map-unavailable" style="display:none"><p>Past distributions unavailable from Neotoma.</p></div>
                                    <div id="neotoma-map"></div>
                                    <div id="range"></div>
                                    <br />
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <hr />
                        <label>Description</label>
                        <div id="gbif-image"></div>
                        <p id="gbif-description"><span class="glyphicon glyphicon-refresh"></span></p>
                        <p><span id="description-source"></span> | <span id="gbif-image-source"></span></p>
                        <a class="btn btn-default" href="http://gbif.org/species/@Model.GbifId" target="_blank">View at GBIF</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <hr />
                        @if (Model.ParentTaxon != null)
                        {
                            <dl class="dl-horizontal">
                                <dt>Parent</dt>
                                <dd>
                                    <ul class="list-inline"><li><a href="/Taxon/View/@Model.ParentTaxon.TaxonId">@Model.ParentTaxon.LatinName</a></li></ul>
                                </dd>
                            </dl>
                        }
                        @if (Model.SubTaxa.Count > 0)
                        {
                            <dl class="dl-horizontal">
                                <dt>Children</dt>
                                <dd>
                                    <ul class="list-inline">
                                        @foreach (var subTaxon in Model.SubTaxa.OrderBy(m => m.LatinName))
                                        {
                                            <li><a href="/Taxon/View/@subTaxon.TaxonId">@subTaxon.LatinName</a></li>
                                        }
                                    </ul>
                                </dd>
                            </dl>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    @* Present Distribution Map *@
    <script type="text/javascript" src="~/lib/leaflet/dist/leaflet.js"></script>
    <script src="~/lib/nouislider/distribute/nouislider.min.js"></script>
    <script src="~/js/taxon/PresentDistribution.js"></script>

    @* Past Distribution Map *@
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="//d3js.org/topojson.v0.min.js"></script>
    <script src="~/lib/wnumb/wNumb.js"></script>
    <script src="~/js/taxon/PastDistribution.js"></script>
}